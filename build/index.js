(()=>{"use strict";const e=window.wp.data,t=window.React,r=window.wp.element,n=window.wp.hooks;function o(){return(0,e.select)("core/block-editor").getBlockSelectionStart()}(0,n.addFilter)("blocks.registerBlockType","iframely/add-attributes",(function(e){return/^embed$/i.test(e.category)&&void 0!==e.attributes&&!e.attributes.iquery&&(e.attributes=Object.assign(e.attributes,{iquery:{type:"string",default:""}})),e})),(0,n.addFilter)("blocks.getSaveElement","iframely/save-query",(function(e,n,o){if(/^embed$/i.test(n.category)&&o.iquery&&o.url){let n=o.url,a=function(e,t){let r=e.replace(/(?:&amp;|\?|&)?iframely=(.+)$/,"");return 0!==Object.keys(t).length&&(r+=(/\?/.test(r)?"&":"?")+"iframely="+encodeURIComponent(window.btoa(JSON.stringify(t)))),r}(o.url,o.iquery);o.url=a;let i=(0,r.renderToString)(e).replace(/&amp;/g,"&").replace(n,a);return(0,t.createElement)(r.RawHTML,null,i)}return e}));const a=window.wp.compose,i=window.wp.blockEditor,l=window.wp.components,c=window.wp.i18n;class s extends r.Component{constructor(t){super(t),this.state={isAdmin:(0,e.select)("core").canUser("create","users")}}updateEmptyPlaceholder(){let e=document.getElementById("iframely-options");e.innerHTML||(e.innerHTML=this.state.isAdmin?(0,c.sprintf)((0,c.__)('If your <a href="%s" target="_blank">plan</a> supports it and config allows, Iframely will show <a href="%s" target="_blank">edit options</a> for selected URL here, whenever available.',"iframely"),"https://iframely.com/plans?utm_source=wordpress-plugin","https://iframely.com/docs/options?utm_source=wordpress-plugin"):(0,c.__)("Iframely will show edit options for selected URL here, whenever available.","iframely"))}componentDidMount(){m(),this.updateEmptyPlaceholder()}componentDidUpdate(){this.updateEmptyPlaceholder()}render(){return(0,t.createElement)("div",{id:"iframely-options",className:"iframely-options"})}}const d=(0,a.createHigherOrderComponent)((e=>n=>!0===n.isSelected&&/^core-?\/?embed/i.test(n.name)?(0,t.createElement)(r.Fragment,null,(0,t.createElement)(e,{...n}),(0,t.createElement)(i.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:(0,c.__)("Iframely options","iframely")},(0,t.createElement)(s,null)))):(0,t.createElement)(r.Fragment,null,(0,t.createElement)(e,{...n}))),"withInspectorControl");function m(){let e="#block-"+o(),t=jQuery(e).find("iframe"),r=jQuery(t).data(),n=o(),a=jQuery("#iframely-options"),i=2===a.length?a.get(1):a.get(0);t&&r&&iframely.buildOptionsForm(n,i,r.data)}(0,n.addFilter)("editor.BlockEdit","iframely/with-inspector-controls",d);const u=new RegExp("setIframelyEmbedOptions");iframely&&iframely.on("options-changed",(function(t,r,n){const a="#block-"+o(),i=document.querySelector(a+" iframe").contentDocument.querySelector("iframe"),l=jQuery(a).find("iframe");if(l&&l.data()&&l.data().data&&l.data().context){const t=l.data();let r=t.context;t.data.query&&t.data.query.length>0&&t.data.query.forEach((function(e){r.indexOf(e)>-1&&(r=r.replace(new RegExp("&?"+e.replace("-","\\-")+"=[^\\?\\&]+"),""))})),Object.keys(n).forEach((function(e){r+=(r.indexOf("?")>-1?"&":"?")+e+"="+n[e]})),function(e){if(e&&!e.iframely){var t=e.document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https:":"http:")+"//if-cdn.com/embed.js";var r=e.document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}}(document.querySelector(a+" iframe").contentWindow),i.src=r,(0,e.dispatch)("core/block-editor").updateBlockAttributes(o(),{iquery:n})}})),window.addEventListener("message",(function(t){if(u.test(t.data)){let r=function(e,t){let r;for(let n=0;n<e.length&&!r;n++){let o=e[n];o.contentWindow===t&&(r=o)}return r}(document.getElementsByTagName("iframe"),t.source),n=JSON.parse(t.data);jQuery(r).data(n);const a=(0,e.select)("core/block-editor").getBlock(o());a&&/^core-?\/?embed/i.test(a.name)&&m()}}),!1),(0,e.select)("core").canUser("create","users")})();