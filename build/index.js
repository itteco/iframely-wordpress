(()=>{"use strict";const e=window.wp.data,t=window.React,n=window.wp.element,r=window.wp.hooks;function o(){let e=document.querySelector("[name=editor-canvas]");return e?e.contentWindow.document:document}function i(){return(0,e.select)("core/block-editor").getBlockSelectionStart()}function a(e){return o().querySelector(`#block-${e} iframe`)}(0,r.addFilter)("blocks.registerBlockType","iframely/add-attributes",(function(e){return/^embed$/i.test(e.category)&&void 0!==e.attributes&&!e.attributes.iquery&&(e.attributes=Object.assign(e.attributes,{iquery:{type:"string",default:""}})),e})),(0,r.addFilter)("blocks.getSaveElement","iframely/save-query",(function(e,r,o){if(/^embed$/i.test(r.category)&&o.iquery&&o.url){let r=o.url,i=function(e,t){let n=e.replace(/(?:&amp;|\?|&)?iframely=(.+)$/,"");return 0!==Object.keys(t).length&&(n+=(/\?/.test(n)?"&":"?")+"iframely="+encodeURIComponent(window.btoa(JSON.stringify(t)))),n}(o.url,o.iquery);o.url=i;let a=(0,n.renderToString)(e).replace(/&amp;/g,"&").replace(r,i);return(0,t.createElement)(n.RawHTML,null,a)}return e}));const l=window.wp.compose,c=window.wp.blockEditor,s=window.wp.components,d=window.wp.i18n;class u extends n.Component{constructor(t){super(t),this.state={isAdmin:(0,e.select)("core").canUser("create","users")}}updateEmptyPlaceholder(){let e=document.getElementById("iframely-options");e&&!e.innerHTML&&(e.innerHTML=this.state.isAdmin?(0,d.sprintf)((0,d.__)('If your <a href="%s" target="_blank">plan</a> supports it and config allows, Iframely will show <a href="%s" target="_blank">edit options</a> for selected URL here, whenever available.',"iframely"),"https://iframely.com/plans?utm_source=wordpress-plugin","https://iframely.com/docs/options?utm_source=wordpress-plugin"):(0,d.__)("Iframely will show edit options for selected URL here, whenever available.","iframely"))}componentDidMount(){setTimeout((()=>{m(),this.updateEmptyPlaceholder()}),10)}componentDidUpdate(){setTimeout((()=>{this.updateEmptyPlaceholder()}),10)}render(){return(0,t.createElement)("div",{id:"iframely-options",className:"iframely-options"})}}function m(){const e=i(),t=a(e),n=jQuery(t).data();let r=jQuery("#iframely-options"),o=2===r.length?r.get(1):r.get(0);t&&n&&iframely.buildOptionsForm(e,o,n.data)}const p=(0,l.createHigherOrderComponent)((e=>r=>!0===r.isSelected&&/^core-?\/?embed/i.test(r.name)?(0,t.createElement)(n.Fragment,null,(0,t.createElement)(e,{...r}),(0,t.createElement)(c.InspectorControls,null,(0,t.createElement)(s.PanelBody,{title:(0,d.__)("Iframely options","iframely")},(0,t.createElement)(u,null)))):(0,t.createElement)(n.Fragment,null,(0,t.createElement)(e,{...r}))),"withInspectorControl");(0,r.addFilter)("editor.BlockEdit","iframely/with-inspector-controls",p),iframely&&iframely.on("options-changed",(function(t,n,r){const o=i(),l=a(o),c=function(e){return a(e).contentWindow.document.querySelector("iframe")}(o),s=jQuery(l)?.data();let d=s?.context;l&&d&&s?.data&&(s.data.query&&s.data.query.length>0&&s.data.query.forEach((function(e){d.indexOf(e)>-1&&(d=d.replace(new RegExp("&?"+e.replace("-","\\-")+"=[^\\?\\&]+"),""))})),Object.keys(r).forEach((function(e){d+=(d.indexOf("?")>-1?"&":"?")+e+"="+r[e]})),function(e){setTimeout((()=>{if(e.document.getElementById("iframely-styles"))return;let t=e.document.createElement("style");t.textContent=".iframely-responsive {\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 0;\n      position: relative;\n      padding-bottom: 56.25%;\n      box-sizing: border-box;\n    }\n    .iframely-responsive > * {\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      border: 0;\n      box-sizing: border-box;\n    }",e.document.head.appendChild(t)}),50)}(function(e){return a(e).contentWindow}(i())),c.src=d,(0,e.dispatch)("core/block-editor").updateBlockAttributes(o,{iquery:r}))})),window.addEventListener("message",(function(t){const n=(r=t?.data,null===r||"function"!=typeof r&&"object"!=typeof r?JSON.parse(t?.data)||{}:t.data);var r;if("setIframelyEmbedOptions"!==n?.method)return;let a=function(e){const t=o().querySelectorAll("iframe");let n=null;return t.forEach((t=>{t.contentWindow===e&&(n=t)})),n}(t.source);if(!a)return;jQuery(a).data(n);const l=(0,e.select)("core/block-editor").getBlock(i());l&&/^core-?\/?embed/i.test(l.name)&&m()})),(0,e.select)("core").canUser("create","users")})();